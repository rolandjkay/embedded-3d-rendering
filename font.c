#include <stdint.h>
#include "display.h"

// Search for '1' in Atom, to make this data readable; it will highlight the 1s.
// The grid is 32 characters wide and 3 rows high.
static const uint8_t font[] = {
0b00011000,0b01101100,0b00110110,0b00001100,0b01100000,0b00111000,0b00001100,0b00001100,0b00110000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00111100,0b00011000,0b00111100,0b00111100,0b00001100,0b01111110,0b00011100,0b01111110,0b00111100,0b00111100,0b00000000,0b00000000,0b00001100,0b00000000,0b00110000,0b00111100,0b00111100,
0b00011000,0b01101100,0b00110110,0b00111111,0b01100110,0b01101100,0b00011000,0b00011000,0b00011000,0b00011000,0b00011000,0b00000000,0b00000000,0b00000000,0b00000110,0b01100110,0b00111000,0b01100110,0b01100110,0b00011100,0b01100000,0b00110000,0b00000110,0b01100110,0b01100110,0b00000000,0b00000000,0b00011000,0b00000000,0b00011000,0b01100110,0b01100110,
0b00011000,0b01101100,0b01111111,0b01101000,0b00001100,0b01101100,0b00110000,0b00110000,0b00001100,0b01111110,0b00011000,0b00000000,0b00000000,0b00000000,0b00001100,0b01101110,0b00011000,0b00000110,0b00000110,0b00111100,0b01111100,0b01100000,0b00001100,0b01100110,0b01100110,0b00011000,0b00011000,0b00110000,0b01111110,0b00001100,0b00001100,0b01101110,
0b00011000,0b00000000,0b00110110,0b00111110,0b00011000,0b00111000,0b00000000,0b00110000,0b00001100,0b00111100,0b01111110,0b00000000,0b01111110,0b00000000,0b00011000,0b01111110,0b00011000,0b00001100,0b00011100,0b01101100,0b00000110,0b01111100,0b00011000,0b00111100,0b00111110,0b00011000,0b00011000,0b01100000,0b00000000,0b00000110,0b00011000,0b01101010,
0b00011000,0b00000000,0b01111111,0b00001011,0b00110000,0b01101101,0b00000000,0b00110000,0b00001100,0b01111110,0b00011000,0b00000000,0b00000000,0b00000000,0b00110000,0b01110110,0b00011000,0b00011000,0b00000110,0b01111110,0b00000110,0b01100110,0b00110000,0b01100110,0b00000110,0b00000000,0b00000000,0b00110000,0b01111110,0b00001100,0b00011000,0b01101110,
0b00000000,0b00000000,0b00110110,0b01111110,0b01100110,0b01100110,0b00000000,0b00011000,0b00011000,0b00011000,0b00011000,0b00011000,0b00000000,0b00011000,0b01100000,0b01100110,0b00011000,0b00110000,0b01100110,0b00001100,0b01100110,0b01100110,0b00110000,0b01100110,0b00001100,0b00011000,0b00011000,0b00011000,0b00000000,0b00011000,0b00000000,0b01100000,
0b00011000,0b00000000,0b00110110,0b00011000,0b00000110,0b00111011,0b00000000,0b00001100,0b00110000,0b00000000,0b00000000,0b00011000,0b00000000,0b00011000,0b00000000,0b00111100,0b01111110,0b01111110,0b00111100,0b00001100,0b00111100,0b00111100,0b00110000,0b00111100,0b00111000,0b00011000,0b00011000,0b00001100,0b00000000,0b00110000,0b00011000,0b00111100,
0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00110000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00110000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,
0b00111100,0b01111100,0b00111100,0b01111000,0b01111110,0b01111110,0b00111100,0b01100110,0b01111110,0b00111110,0b01100110,0b01100000,0b01100011,0b01100110,0b00111100,0b01111100,0b00111100,0b01111100,0b00111100,0b01111110,0b01100110,0b01100110,0b01100011,0b01100110,0b01100110,0b01111110,0b01111100,0b00000000,0b00111110,0b00011000,0b00000000,0b00011100,
0b01100110,0b01100110,0b01100110,0b01101100,0b01100000,0b01100000,0b01100110,0b01100110,0b00011000,0b00001100,0b01101100,0b01100000,0b01110111,0b01100110,0b01100110,0b01100110,0b01100110,0b01100110,0b01100110,0b00011000,0b01100110,0b01100110,0b01100011,0b01100110,0b01100110,0b00000110,0b01100000,0b01100000,0b00000110,0b00111100,0b00000000,0b00110110,
0b01100110,0b01100110,0b01100000,0b01100110,0b01100000,0b01100000,0b01100000,0b01100110,0b00011000,0b00001100,0b01111000,0b01100000,0b01111111,0b01110110,0b01100110,0b01100110,0b01100110,0b01100110,0b01100000,0b00011000,0b01100110,0b01100110,0b01101011,0b00111100,0b01100110,0b00001100,0b01100000,0b00110000,0b00000110,0b01100110,0b00000000,0b00110000,
0b01111110,0b01111100,0b01100000,0b01100110,0b01111100,0b01111100,0b01101110,0b01111110,0b00011000,0b00001100,0b01110000,0b01100000,0b01101011,0b01111110,0b01100110,0b01111100,0b01100110,0b01111100,0b00111100,0b00011000,0b01100110,0b01100110,0b01101011,0b00011000,0b00111100,0b00011000,0b01100000,0b00011000,0b00000110,0b01000010,0b00000000,0b01111100,
0b01100110,0b01100110,0b01100000,0b01100110,0b01100000,0b01100000,0b01100110,0b01100110,0b00011000,0b00001100,0b01111000,0b01100000,0b01101011,0b01101110,0b01100110,0b01100000,0b01101010,0b01101100,0b00000110,0b00011000,0b01100110,0b01100110,0b01111111,0b00111100,0b00011000,0b00110000,0b01100000,0b00001100,0b00000110,0b00000000,0b00000000,0b00110000,
0b01100110,0b01100110,0b01100110,0b01101100,0b01100000,0b01100000,0b01100110,0b01100110,0b00011000,0b01101100,0b01101100,0b01100000,0b01100011,0b01100110,0b01100110,0b01100000,0b01101100,0b01100110,0b01100110,0b00011000,0b01100110,0b00111100,0b01110111,0b01100110,0b00011000,0b01100000,0b01100000,0b00000110,0b00000110,0b00000000,0b00000000,0b00110000,
0b01100110,0b01111100,0b00111100,0b01111000,0b01111110,0b01100000,0b00111100,0b01100110,0b01111110,0b00111000,0b01100110,0b01111110,0b01100011,0b01100110,0b00111100,0b01100000,0b00110110,0b01100110,0b00111100,0b00011000,0b00111100,0b00011000,0b01100011,0b01100110,0b00011000,0b01111110,0b01111100,0b00000000,0b00111110,0b00000000,0b00000000,0b01111110,
0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b11111111,0b00000000,
0b00000000,0b01100000,0b00000000,0b00000110,0b00000000,0b00011100,0b00000000,0b01100000,0b00011000,0b00011000,0b01100000,0b00111000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00110000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00001100,0b00011000,0b00110000,0b00000000,0b00000000,0b00000000,
0b00000000,0b01100000,0b00000000,0b00000110,0b00000000,0b00110000,0b00000000,0b01100000,0b00000000,0b00000000,0b01100000,0b00011000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00110000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00011000,0b00011000,0b00011000,0b00000000,0b00000000,0b00000000,
0b00111100,0b01111100,0b00111100,0b00111110,0b00111100,0b00110000,0b00111110,0b01111100,0b00111000,0b00111000,0b01100110,0b00011000,0b00110110,0b01111100,0b00111100,0b01111100,0b00111110,0b01101100,0b00111110,0b01111100,0b01100110,0b01100110,0b01100011,0b01100110,0b01100110,0b01111110,0b00011000,0b00011000,0b00011000,0b00000000,0b00000000,0b00000000,
0b00000110,0b01100110,0b01100110,0b01100110,0b01100110,0b01111100,0b01100110,0b01100110,0b00011000,0b00011000,0b01101100,0b00011000,0b01111111,0b01100110,0b01100110,0b01100110,0b01100110,0b01110110,0b01100000,0b00110000,0b01100110,0b01100110,0b01101011,0b00111100,0b01100110,0b00001100,0b01110000,0b00000000,0b00001110,0b00000000,0b00000000,0b00000000,
0b00111110,0b01100110,0b01100000,0b01100110,0b01111110,0b00110000,0b01100110,0b01100110,0b00011000,0b00011000,0b01111000,0b00011000,0b01101011,0b01100110,0b01100110,0b01100110,0b01100110,0b01100000,0b00111100,0b00110000,0b01100110,0b01100110,0b01101011,0b00011000,0b01100110,0b00011000,0b00011000,0b00011000,0b00011000,0b00000000,0b00000000,0b00000000,
0b01100110,0b01100110,0b01100110,0b01100110,0b01100000,0b00110000,0b00111110,0b01100110,0b00011000,0b00011000,0b01101100,0b00011000,0b01101011,0b01100110,0b01100110,0b01111100,0b00111110,0b01100000,0b00000110,0b00110000,0b01100110,0b00111100,0b01111111,0b00111100,0b00111110,0b00110000,0b00011000,0b00011000,0b00011000,0b00000000,0b00000000,0b00000000,
0b00111110,0b01111100,0b00111100,0b00111110,0b00111100,0b00110000,0b00000110,0b01100110,0b00111100,0b00011000,0b01100110,0b00111100,0b01100011,0b01100110,0b00111100,0b01100000,0b00000110,0b01100000,0b01111100,0b00011100,0b00111110,0b00011000,0b00110110,0b01100110,0b00000110,0b01111110,0b00001100,0b00011000,0b00110000,0b00000000,0b00000000,0b00000000,
0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00111100,0b00000000,0b00000000,0b01110000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b01100000,0b00000111,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00111100,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000,0b00000000
};

#define LOG_STRIDE 5
#define LOG_SCREEN_STRIDE 4

void font_write_char(Display* display, char c, size_t x, size_t y)
{
  uint8_t* screen_buffer = display_get_buffer(display) + (x >> 3) + (y << LOG_SCREEN_STRIDE);
  // Given a stride of 32, upper 3 bits give character row, lower 5 give offset
  // in row.
  int d = c - '!';
  const uint8_t* char_data = &font[((d & 0b11100000) << 3) + (d & 0b00011111)] ;

  for (int i = 0; i < 8 ; ++i)
  {
    *(screen_buffer + (i << LOG_SCREEN_STRIDE)) = *(char_data + (i << LOG_STRIDE));
  }

  display_release_buffer(display);
}

void font_write_string(Display* display, const char* str, size_t n, size_t x, size_t y)
{
  uint8_t* screen_buffer = display_get_buffer(display) + (x >> 3) + (y << LOG_SCREEN_STRIDE);

  for (int scan_line_index = 0; scan_line_index < 8 ; ++scan_line_index)
  {
    uint8_t* screen_ptr = screen_buffer + (scan_line_index << LOG_SCREEN_STRIDE);

    //for (const char* c = str; *c; ++c, ++screen_ptr)
    for (int char_index = 0;
         str[char_index] && char_index < n;
         ++char_index, ++screen_ptr)
    {
      int d = str[char_index] - '!';
      const uint8_t* char_data = &font[((d & 0b11100000) << 3) + (d & 0b00011111)] ;

      *screen_ptr = *(char_data + (scan_line_index << LOG_STRIDE));
    }
  }

  display_release_buffer(display);
}
